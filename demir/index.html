<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demir - CBAM Tax Calc || Bulut Pektemir</title>
    <link rel="stylesheet" href="../reset.css" />
    <link rel="stylesheet" href="../calc.css" />

    <style></style>
  </head>

  <body>
    <div id="root">
      <nav class="bg">
        <a href="/" id="back-button">
          <object
            data="../back.svg"
            width="16px"
            height="20px"
            type="image/svg+xml"
          ></object>
        </a>
        <a href="/demir/" class="active"> Demir - Çelik </a>
        <a href="/alimunyum/"> Alimunyum </a>
        <a href="/gubre/"> Gübre </a>
        <a href="/elektrik/"> Elektrik </a>
        <a href="/hidrojen/"> Hidrojen </a>
        <a href="/cimento/"> Çimento </a>
      </nav>

      <form id="mainForm">
        <!-- ÜSTTEKİ GENEL ALAN Start -->
        <section class="bg">
          <label for="amountExported">
            Amount Exported
            <input
              type="text"
              name="amountExported"
              id="amountExported"
              placeholder="(e.g., CN 073)"
              value="50"
            />
          </label>

          <label for="weekly-ETS-price"
            >weekly ETS price
            <input
              type="text"
              name="weeklyETSPrice"
              id="weekly-ETS-price"
              placeholder="(e.g., CN 073)"
              value="50"
            />
          </label>

          <label for="emissionCap"
            >emission cap
            <input
              type="text"
              name="emissionCap"
              id="emissionCap"
              placeholder="(e.g., CN 073)"
              value=" 50"
            />
          </label>
        </section>
        <!-- ÜSTTEKİ GENEL ALAN End -->

        <div class="scopes-provider">
          <div class="bg scope-one">
            <h4>Scope 1</h4>

            <!-- YENİ ALAN İÇİN BURAYI KOPYALA -->

            <!-- HATIRLATMALAR -->
            <!-- #1 Label'ın For'u Input'un ID'si İle aynı olmalı -->
            <!-- #2 taxtCalc.JS Dosyasında Input Name ile yakalanacak -->
            <!-- #3 Input'un palaceholder düzenlenmeli -->

            <!-- ---------------------------------------------------------------- -->

            <label for="palletisationOperation"
              >palletisationOperation
              <input
                type="number"
                name="palletisationOperation"
                id="palletisationOperation"
                placeholder="(e.g., CN 073)"
                value="0"
              />
            </label>

            <!-- ---------------------------------------------------------------- -->
            <!-- YENİ ALAN İÇİN BURAYI KOPYALA -->

            <label for="cokeOvengasCombusition"
              >cokeOvengasCombusition
              <input
                type="number"
                name="cokeOvengasCombusition"
                id="cokeOvengasCombusition"
                placeholder="(e.g., CN 073)"
                value="0"
              />
            </label>

            <label for="blastFurnaceGasCombustion"
              >BlastFurnaceGasCombustion
              <input
                type="text"
                name="blastFurnaceGasCombustion"
                id="blastFurnaceGasCombustion"
                placeholder="(e.g., CN 073)"
                value="0"
              />
            </label>
          </div>

          <div class="bg scope-two">
            <h4>Scope 2</h4>

            <label for="electricityForProductionProcess"
              >ElectricityForProductionProcess
              <input
                type="text"
                name="electricityForProductionProcess"
                id="electricityForProductionProcess"
                placeholder="(e.g., CN 073)"
                value="0"
              />
            </label>

            <label for="electricityForLigting"
              >ElectricityForLigting
              <input
                type="text"
                name="electricityForLigting"
                id="electricityForLigting"
                placeholder="(e.g., CN 073)"
                value="0"
              />
            </label>
          </div>

          <div class="bg scope-three">
            <h4>Scope 3</h4>

            <label for="rawMaterialTransportation"
              >RawMaterialTransportation
              <input
                type="text"
                name="rawMaterialTransportation"
                id="rawMaterialTransportation"
                placeholder="(e.g., CN 073)"
                value="0"
              />
            </label>

            <label for="employeeCommuting">
              EmployeeCommuting
              <input
                type="text"
                name="employeeCommuting"
                id="employeeCommuting"
                placeholder="(e.g., CN 073)"
                value="0"
              />
            </label>
          </div>
        </div>

        <section class="bg buttons">
          <button type="reset">Reset</button>
          <button type="submit">Submit</button>
        </section>
      </form>

      <h4>Sonuçlar</h4>
      <output id="outputArea">
        <!-- <div class="total-em-result bg">
          <p>Total Em</p>
          <h4>Total Em</h4>
        </div>

        <div class="tax-result bg">
          <p>asd</p>
          <h4>Tax Res</h4>
        </div>

        <div class="graph-result bg">
          <p>asd</p>
          <h4>graph</h4>
        </div>
        <div class="emission-cap bg">
          <p>asd</p>
          <h4>emission-cap</h4>
        </div>
        <div class="emission-cap-percent bg">
          <p>asd</p>
          <h4>emission-cap percent</h4>
        </div>
        <div class="wekly bg">
          <p>asd</p>
          <h4>Weekly</h4>
        </div>
        <div class="scope-one-result bg">
          <p>asd</p>
          <h4>Scope1 Res</h4>
        </div>
        <div class="scope-two-result bg">
          <p>asd</p>
          <h4>Scope2 Res</h4>
        </div>
        <div class="scope-three-result bg">
          <p>asd</p>
          <h4>Scope3 Res</h4>
        </div>
        <div class="scope-all-result bg">
          <p>asd</p>
          <h4>all Scopes Res</h4>
        </div> -->
      </output>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script>
        const emissionFactors = {
            "CN001": 1,
            "CN002": 1.2,
            "CN003": 0.8,
            "CN004": 1.4,
            "CN005": 1.6,
            "CN006": 1.7,
            "CN007": 0.4,
            "CN008": 0.2,
            "CN009": 0.1,
            "CN010": 0.05,
            "CN011": 2.4,
            "CN012": 1.3,
            "CN013": 4.2,
            "CN014": 3.2,
            "CN015": 2.3,
            "CN016": 1.7,
            "CN017": 1.9,
            "CN018": 6.5,
            "CN019": 3.21,
            "CN020": 2.31,
            "CN021": 5.12,
            "CN022": 4.44,
            "CN023": 9.4,
            "CN024": 4.54,
            "CN025": 9.00,
            "CN026": 6.00,
            "CN027": 4.23,
            "CN028": 9.32,
            "CN029": 13.2,
            "CN030": 10.2,
            "CN031": 4.25,
            "CN032": 5.66,
            "CN033": 8.74,
            "CN034": 0.06,
            "CN035": 0.02,
            "CN036": 0.03,
            "CN037": 0.23,
            "CN038": 0.94
        };

        const weeklyETSTax = 50; // birimi euro
        const emissionLimit = 1323382; // birimi milyon ton CO2
        const scope2Factor = 2.44; // birimi ton başına CO2
        const scope3Factor = 3.02; // birimi ton başına CO2

        let resultValEl = document.getElementById('result-value');
        let pieContEl = document.getElementById('pie-graph-container')






        let createGraph = (data) => {

            // canvas oluştur

            const canvas = document.createElement('canvas');
            canvas.id = 'myChart';
            pieContEl.appendChild(canvas);
            const ctx = document.getElementById('myChart');

            // grafik oluştur
            new Chart(ctx, 
            {
                type: 'doughnut',
                data: {
                    labels: ['Scope 1', 'Scope 2', 'Scope 3'],
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#CEF238',
                            '#F24A38',
                            '#3889F2'
                        ],
                    }]
                },

                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },

                    },

                },
            }
            );

        }




        function calculateCBAMTax(productCode, producedAmount, scope2Electricity, scope3Amount) {

            // hesaplamayı yap

            const emissionFactor = emissionFactors[productCode];

            let scopeOneRes = (producedAmount * emissionFactor);
            let scopeTwoRes = (scope2Electricity * scope2Factor);
            let scopeThreeRes = (scope3Amount * scope3Factor);

            const totalEmission = scopeOneRes + scopeTwoRes + scopeThreeRes;

            let cbamTax = 0;
            if (totalEmission > emissionLimit) {
                cbamTax = (totalEmission - emissionLimit) * weeklyETSTax * producedAmount;
            }

            // hesap sonucunu ekrana bas
            resultValEl.innerHTML = cbamTax;

            let data = [scopeOneRes, scopeTwoRes, scopeThreeRes]

            // grafik oluşturucu fonksiyonu çağır
            createGraph(data);

        }


        // form submit olduğunda
        let formSubmit = (e) => {

            // varsayılan davranış sıfırla
            e.preventDefault();

            // sonuçları sıfırla
            resultValEl.innerHTML = ""
            pieContEl.innerHTML = ""

            // inputları yakala
            const productCode = document.getElementById("product-code").value;
            const producedAmount = document.getElementById("produced-amount").value;
            const scope2Electricity = document.getElementById("scope-two").value;
            const scope3Amount = document.getElementById("scope-three").value;

            // productCode boşluk sil
            function convertToValidFormat(input) {
                return input.replace(/\s+/g, '').toUpperCase();
            }

            let convertedProductCode = convertToValidFormat(productCode)

            // productCode var mı kontrol et
            checkEmissionFactor(convertedProductCode);


            function checkEmissionFactor(productCode) {
                if (emissionFactors.hasOwnProperty(productCode)) {
                    // productCode doğru ise hesaplama fonksiyonunu çalıştır
                    calculateCBAMTax(convertedProductCode, producedAmount, scope2Electricity, scope3Amount)
                } else {
                    // productCode yanlış ise uyarı ver
                    alert("Please Check The Product Code. The product code must start with 'cn'. The relevant number must be 3 digits. Example: 'CN001'")
                }
            }








        }



        let formEl = document.getElementById('input-form');
        formEl.addEventListener('submit', (e) => formSubmit(e));
        formEl.addEventListener('reset', (e) => formReset(e));


        // form reset olduğunda
        function formReset(e) {
            resultValEl.innerHTML = ""
            pieContEl.innerHTML = ""

        }




    </script> -->
    <script src="./taxCalc.js" defer></script>
  </body>
</html>
